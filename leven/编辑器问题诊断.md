# ç¼–è¾‘å™¨ä½ç½®é—®é¢˜è¯Šæ–­å’Œä¿®å¤

## ğŸ“· ä»æˆªå›¾è§‚å¯Ÿåˆ°çš„é—®é¢˜

1. **æ°´å¹³ä½ç½®ï¼ˆXï¼‰**ï¼šâœ… æ­£ç¡® - ç¼–è¾‘æ¡†åœ¨Emailåˆ—
2. **å‚ç›´ä½ç½®ï¼ˆYï¼‰**ï¼šâŒ ä¸å¯¹ - æœ‰å¤šä¸ªç¼–è¾‘æ¡†æ˜¾ç¤ºåœ¨ä¸åŒè¡Œ
3. **ç¼–è¾‘æ¡†æ•°é‡**ï¼šâŒ åº”è¯¥åªæœ‰1ä¸ªï¼Œä½†æœ‰3ä¸ª
4. **æ˜¾ç¤ºå€¼**ï¼šéœ€è¦ç¡®è®¤æ˜¯å¦æ˜¾ç¤ºäº†æ­£ç¡®çš„å•å…ƒæ ¼å€¼

## ğŸ” é—®é¢˜åˆ†æ

### å¯èƒ½çš„åŸå› 

**åŸå› 1ï¼šå‚ç›´ä½ç½®åç§»ç´¯åŠ **
- `rect.y` çš„è®¡ç®—ï¼š`coordInstance.getRowOffset(rowIndex) - scrollTop`
- å¦‚æœ`rowInitSize`æˆ–å®¹å™¨çš„topåç§»æ²¡æœ‰è¢«æ­£ç¡®è€ƒè™‘ï¼Œå¯èƒ½å¯¼è‡´Yåæ ‡åç§»

**åŸå› 2ï¼špaddingå½±å“**
- SimpleDemoçš„å®¹å™¨æœ‰ `className="p-4"`ï¼ˆpadding: 16pxï¼‰
- è¿™ä¸ªpaddingå¯èƒ½å½±å“äº†Gridçš„å®é™…ä½ç½®
- EditorContainerå®šä½æ—¶æ²¡æœ‰è€ƒè™‘è¿™ä¸ªoffset

**åŸå› 3ï¼šå¤šä¸ªç¼–è¾‘å™¨å®ä¾‹**
- Reactä¸¥æ ¼æ¨¡å¼å¯èƒ½å¯¼è‡´å¤šæ¬¡æ¸²æŸ“
- æˆ–è€…EditorContaineråœ¨ä¸åŒçš„activeCellçŠ¶æ€ä¸‹éƒ½åœ¨æ¸²æŸ“

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šä¿®å¤å®¹å™¨paddingå¯¼è‡´çš„åç§»

ä¿®æ”¹ SimpleDemo.tsxï¼Œç§»é™¤Gridçˆ¶å®¹å™¨çš„paddingï¼Œæ”¹ç”¨marginï¼š

```tsx
// å½“å‰ï¼ˆæœ‰é—®é¢˜ï¼‰
<div className="p-4 relative" style={{ height: '600px' }}>
  <Grid ... />
</div>

// ä¿®æ”¹ä¸º
<div className="m-4 relative" style={{ height: '600px' }}>
  <Grid ... />
</div>
```

æˆ–è€…å®Œå…¨ä½¿ç”¨ç»å¯¹å®šä½ï¼š

```tsx
<div className="relative" style={{ height: '600px', padding: '16px' }}>
  <div className="absolute inset-4">
    <Grid ... />
  </div>
</div>
```

### æ–¹æ¡ˆ2ï¼šè°ƒæ•´EditorContainerçš„å®šä½åŸºå‡†

å¦‚æœæ–¹æ¡ˆ1ä¸è¡Œï¼Œè¯´æ˜EditorContainerçš„å®šä½éœ€è¦è€ƒè™‘Gridçˆ¶å®¹å™¨çš„offsetã€‚

ä¿®æ”¹ EditorContainer.tsx ä¸­çš„ä½ç½®è®¡ç®—ï¼Œæ·»åŠ å®¹å™¨offsetï¼š

```tsx
const rect = useMemo(() => {
  const { rowInitSize, columnInitSize, containerWidth, containerHeight } = coordInstance;
  
  // è·å–Gridå®¹å™¨ç›¸å¯¹äºå…¶çˆ¶å®¹å™¨çš„åç§»
  const gridContainer = document.querySelector('[data-t-grid-container]');
  const gridParent = gridContainer?.parentElement;
  const offsetY = gridParent && gridContainer 
    ? gridContainer.getBoundingClientRect().y - gridParent.getBoundingClientRect().y
    : 0;
  
  const x = clamp(
    coordInstance.getColumnRelativeOffset(columnIndex, scrollLeft),
    columnInitSize,
    containerWidth - width
  );
  const y = clamp(
    coordInstance.getRowOffset(rowIndex) - scrollTop,
    rowInitSize,
    containerHeight - height
  );

  return {
    x,
    y, // æˆ–è€… y + offsetY å¦‚æœéœ€è¦è¡¥å¿offset
    width,
    height,
    editorId,
  };
}, [coordInstance, rowIndex, columnIndex, width, height, scrollLeft, scrollTop, editorId]);
```

### æ–¹æ¡ˆ3ï¼šç§»é™¤StrictModeï¼ˆä¸´æ—¶æµ‹è¯•ï¼‰

åœ¨ main.tsx ä¸­ä¸´æ—¶ç§»é™¤StrictModeæ¥æµ‹è¯•æ˜¯å¦æ˜¯åŒé‡æ¸²æŸ“å¯¼è‡´çš„ï¼š

```tsx
// ä¸´æ—¶æµ‹è¯•
root.render(<SimpleDemo />)

// è€Œä¸æ˜¯
root.render(
  <StrictMode>
    <SimpleDemo />
  </StrictMode>
)
```

---

## ğŸ¯ æ¨èçš„ä¿®å¤é¡ºåº

1. **å…ˆè¯•æ–¹æ¡ˆ1**ï¼šç§»é™¤paddingï¼Œæ”¹ç”¨marginæˆ–ç»å¯¹å®šä½
2. **å¦‚æœä¸è¡Œå†è¯•æ–¹æ¡ˆ2**ï¼šè°ƒæ•´ä½ç½®è®¡ç®—è€ƒè™‘å®¹å™¨offset
3. **æœ€åè¯•æ–¹æ¡ˆ3**ï¼šä¸´æ—¶ç§»é™¤StrictModeæµ‹è¯•

---

**ä¸‹ä¸€æ­¥**ï¼šè¯·å‘Šè¯‰æˆ‘æƒ³å…ˆå°è¯•å“ªä¸ªæ–¹æ¡ˆï¼Œæˆ–è€…æä¾›æ›´å¤šæˆªå›¾/ä¿¡æ¯


